(this["webpackJsonpkeypath-client"]=this["webpackJsonpkeypath-client"]||[]).push([[0],{143:function(t,e,n){"use strict";n.r(e);var a=n(10),s=n(9),r=n.n(s),i=n(78),o=n.n(i),c=(n(92),n(93),n(83)),h=n(12),l=n(7),d=n(6),u=n.n(d),b=n(8),y=n(0),m=n(1),p=n(5),j=n(3),f=n(2),v=n(79),g=n(49),S=n.n(g),O=n(11),k=n(81),w=n.n(k),x=n(82),T=function(){function t(){Object(y.a)(this,t)}return Object(m.a)(t,[{key:"getRandomBassSynth",value:function(){var t=Math.floor(4*Math.random());return this.getBassSynth(t)}},{key:"getBassSynth",value:function(t){var e;switch(t){case 0:return(e=new O.a).toDestination(),e.volume.value=-8,{selection:t,synth:e};case 1:return(e=new O.e).toDestination(),e.volume.value=-15,{selection:t,synth:e};case 2:return(e=new O.i).toDestination(),e.volume.value=-25,{selection:t,synth:e};case 3:return(e=new O.n).toDestination(),e.volume.value=-10,{selection:t,synth:e}}}},{key:"getRandomChordSynth",value:function(){var t=Math.floor(3*Math.random());return this.getChordSynth(t)}},{key:"getChordSynth",value:function(t){var e;switch(t){case 0:(e=(new O.a).toDestination()).volume.value=-30;var n=new O.q(4,.75).toDestination().start(),a=new O.j({frequency:6,octaves:5,baseFrequency:1e3}).toDestination(),s=new O.c(50,6,-30).toDestination(),r=new O.k("4n",.2).toDestination();return e.chain(r,s,a,n),{selection:t,synth:e};case 1:(e=(new O.m).toDestination()).volume.value=-20;var i=new O.b("4n").toDestination().start(),o=new O.f("8n",.5).toDestination();return e.chain(i,o),{selection:t,synth:e};case 2:(e=(new O.m).toDestination()).volume.value=-40;var c=new O.d(4,2.5,.5),h=new O.g(.7).toDestination();return e.chain(c,h),{selection:t,synth:e}}}},{key:"getRandomTrebleSynth",value:function(){var t=Math.floor(4*Math.random());return this.getTrebleSynth(t)}},{key:"getTrebleSynth",value:function(t){var e;switch(t){case 0:(e=(new O.a).toDestination()).volume.value=-30;var n=new O.q(4,.75).toDestination().start(),a=new O.j({frequency:6,octaves:5,baseFrequency:1e3}).toDestination(),s=new O.c(50,6,-30).toDestination(),r=new O.k("4n",.2).toDestination();return e.chain(r,s,a,n),{selection:t,synth:e};case 1:(e=(new O.m).toDestination()).volume.value=-30;var i=new O.b("4n").toDestination().start(),o=new O.f("8n",.5).toDestination();return e.chain(i,o),{selection:t,synth:e};case 2:(e=(new O.i).toDestination()).volume.value=-40;var c=new O.g(.8).toDestination(),h=new O.k("4n",.1).toDestination();return e.chain(h,c),{selection:t,synth:e};case 3:(e=(new O.h).toDestination()).volume.value=-50;var l=new O.g(.8).toDestination();return e.chain(l),{selection:t,synth:e}}}}]),t}(),D=function(t){Object(j.a)(n,t);var e=Object(f.a)(n);function n(){var t;return Object(y.a)(this,n),(t=e.call(this)).SESSION_ID=void 0,t.API_ROOT="http://localhost:80/",t.PATH_ORIGIN=0,t.PATH_DESTINATION=83,t.synthChordStack=[],t.synthBassStack=[],t.synthTrebleStack=[],t.midi=void 0,t.graphData={},t.chordCount=0,t.chordIndex=0,t.tonePlayers=[],t.currentLoop=-1,t.currentTrebleSynth=-1,t.currentChordSynth=-1,t.currentBassSynth=-1,t.loadAudioFile=Object(b.a)(u.a.mark((function e(){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.currentLoop,t.state.shuffleSounds.loop&&(n=t.API_ROOT+"output/loops/"+Math.floor(27*Math.random())+"-loop.mp3",t.currentLoop=n),(a=new O.l(n).toDestination()).set({volume:-20}),t.tonePlayers.push(a);case 5:case"end":return e.stop()}}),e)}))),t.loadGraphData=Object(b.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 83,0,t.PATH_DESTINATION=Math.floor(84*Math.random()+0),e.next=5,S.a.get("".concat(t.API_ROOT,"graph/").concat(t.SESSION_ID,"/").concat(t.PATH_ORIGIN,"/").concat(t.PATH_DESTINATION));case 5:n=e.sent,t.graphData=n.data.data,t.PATH_ORIGIN=n.data.data.destination;case 8:case"end":return e.stop()}}),e)}))),t.loadMidiData=Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.Midi.fromUrl("".concat(t.API_ROOT).concat(t.graphData.midi));case 2:t.midi=e.sent;case 3:case"end":return e.stop()}}),e)}))),t.renderGraph=Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState(Object(l.a)(Object(l.a)({},t.state),{},{data:t.graphData,loading:!1}));case 1:case"end":return e.stop()}}),e)}))),t.initAudio=Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.startBtn.isPlaying){e.next=2;break}return e.abrupt("return");case 2:return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{startBtn:{isPlaying:!0,css:"start-btn-overlay-hide"}})),e.next=5,t.loadAudioFile();case 5:return e.next=7,t.loadGraphData();case 7:return e.next=9,t.loadMidiData();case 9:return e.next=11,t.renderGraph();case 11:return e.next=13,t.startSeqence();case 13:O.p.bpm.value=60,O.p.start();case 15:case"end":return e.stop()}}),e)}))),t.startSeqence=Object(b.a)(u.a.mark((function e(){var n,a,s,r,i,o,c,h,d,y,m,p,j,f,v,g,S,k,w,x,T,D,C,N,I,P,A,R,B,_,H,E,M;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t.disposedUnused(),n=[],a=void 0,t.state.shuffleSounds.chords?(s=t.SYNTH_PRODUCER.getRandomChordSynth(),r=s.selection,i=s.synth,t.currentChordSynth=r,a=i):(o=t.SYNTH_PRODUCER.getChordSynth(t.currentChordSynth),c=o.selection,h=o.synth,t.currentChordSynth=c,a=h),t.synthChordStack.push(a),d=t.midi.tracks[0],y=d.notes,m=-1,p=0;p<y.length;p++)y[p].time!==m&&(m=y[p].time,t.chordCount++),j=t.preventTimeCollision(O.r()+y[p].time,n),a.triggerAttackRelease(y[p].name,y[p].duration,j,.5);for(f=void 0,t.state.shuffleSounds.bass?(v=t.SYNTH_PRODUCER.getRandomBassSynth(),g=v.selection,S=v.synth,t.currentBassSynth=g,f=S):(k=t.SYNTH_PRODUCER.getBassSynth(t.currentBassSynth),w=k.selection,x=k.synth,t.currentBassSynth=w,f=x),t.synthBassStack.push(f),d=t.midi.tracks[1],y=d.notes,m=-1,T=0;T<y.length;T++)y[T].time!==m&&(m=y[T].time),D=t.preventTimeCollision(O.r()+y[T].time,n),f.triggerAttackRelease(y[T].name,y[T].duration,D,.5);for(C=void 0,t.state.shuffleSounds.treble?(N=t.SYNTH_PRODUCER.getRandomTrebleSynth(),I=N.selection,P=N.synth,t.currentTrebleSynth=I,C=P):(A=t.SYNTH_PRODUCER.getTrebleSynth(t.currentBassSynth),R=A.selection,B=A.synth,t.currentTrebleSynth=R,C=B),t.synthTrebleStack.push(C),d=t.midi.tracks[2],y=d.notes,m=-1,_=0;_<y.length;_++)y[_].time!==m&&(m=y[_].time),H=t.preventTimeCollision(O.r()+y[_].time,n),C.triggerAttackRelease(y[_].name,y[_].duration,H,.5);for(E=function(e){O.p.scheduleOnce(Object(b.a)(u.a.mark((function n(){var a;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.tonePlayers[t.tonePlayers.length-1].start(),a=0;case 2:if(!(a<t.state.data.nodes.length)){n.next=11;break}if(t.state.data.nodes[a].id!==t.state.data.chordpathids[e]){n.next=8;break}return t.state.data.nodes[a].size=800,t.state.data.nodes[a].color="white",t.setState(Object(l.a)(Object(l.a)({},t.state.data),{},{nodes:t.state.data.nodes})),n.abrupt("break",11);case 8:a++,n.next=2;break;case 11:case"end":return n.stop()}}),n)}))),t.preventTimeCollision(new O.o(t.chordCount-t.state.data.chordpathids.length+e+":0:0"),n))},M=0;M<t.state.data.chordpathids.length+1;M++)E(M);O.p.scheduleOnce(Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.shuffleSounds(),e.next=3,t.loadAudioFile();case 3:return e.next=5,t.loadGraphData();case 5:return e.next=7,t.loadMidiData();case 7:case"end":return e.stop()}}),e)}))),t.preventTimeCollision(new O.o(t.chordCount-1+":0:0"),n)),O.p.scheduleOnce(Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.renderGraph();case 2:return e.next=4,t.startSeqence();case 4:case"end":return e.stop()}}),e)}))),t.preventTimeCollision(new O.o(t.chordCount+":0:0"),n));case 27:case"end":return e.stop()}}),e)}))),t.SESSION_ID=w()(),t.state={shuffleSounds:{loop:!0,treble:!0,chords:!0,bass:!0},startBtn:{isPlaying:!1,css:"start-btn-overlay-show"},divStyle:{color:"blue"},loading:!0,data:{idkeychordmap:{},chordpathids:[0],nodes:[{id:99,hkey:"a#",note:"a#",chord:"maj7",keyAndNote:"a#,a#-maj7",color:"pink",labelText:"a#,a#-maj7"}],links:[]},myconfig:{initialZoom:1,width:t.getWidth(),height:t.getHeight(),nodeHighlightBehavior:!1,node:{labelPosition:"center",labelProperty:"labelText",strokeColor:"grey",strokeWidth:1,fontColor:"grey",renderLabel:!0,size:850,highlightStrokeColor:"white"}}},t.SYNTH_PRODUCER=new T,t.updateWindowDimensions=t.updateWindowDimensions.bind(Object(p.a)(t)),t}return Object(m.a)(n,[{key:"shouldShuffle",value:function(){return Math.random()<.5}},{key:"shuffleSounds",value:function(){this.setState(Object(l.a)(Object(l.a)({},this.state),{},{shuffleSounds:{loop:this.shouldShuffle(),treble:this.shouldShuffle(),chords:this.shouldShuffle(),bass:this.shouldShuffle()}}))}},{key:"disposedUnused",value:function(){this.synthChordStack.length>0&&(this.synthChordStack[this.synthChordStack.length-1].unsync(),this.synthChordStack.length>1&&(this.synthChordStack[this.synthChordStack.length-2].disposed||this.synthChordStack[this.synthChordStack.length-2].dispose())),this.synthBassStack.length>0&&(this.synthBassStack[this.synthBassStack.length-1].unsync(),this.synthBassStack.length>1&&(this.synthBassStack[this.synthBassStack.length-2].disposed||this.synthBassStack[this.synthBassStack.length-2].dispose())),this.synthTrebleStack.length>0&&(this.synthTrebleStack[this.synthTrebleStack.length-1].unsync(),this.synthTrebleStack.length>1&&(this.synthTrebleStack[this.synthTrebleStack.length-2].disposed||this.synthTrebleStack[this.synthTrebleStack.length-2].dispose())),this.tonePlayers.length>1&&(this.tonePlayers[this.tonePlayers.length-2].disposed||this.tonePlayers[this.tonePlayers.length-2].dispose())}},{key:"preventTimeCollision",value:function(t,e){return e.includes(t)&&(t+=1e-5),e.push(t),t}},{key:"componentDidMount",value:function(){var t=Object(b.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions),83,0,this.PATH_DESTINATION=Math.floor(84*Math.random()+0),t.next=7,S.a.get("".concat(this.API_ROOT,"graph/").concat(this.SESSION_ID,"/").concat(this.PATH_ORIGIN,"/").concat(this.PATH_DESTINATION));case 7:e=t.sent,this.PATH_ORIGIN=e.data.data.destination,e.data.myconfig.width=this.getWidth(),e.data.myconfig.height=this.getHeight(),this.setState(Object(l.a)(Object(l.a)({},this.state),{},{data:e.data.data,myconfig:e.data.myconfig,loading:!1}));case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}},{key:"updateWindowDimensions",value:function(){this.setState(Object(l.a)(Object(l.a)({},this.state.myconfig),{},{width:this.getWidth(),height:this.getHeight()}))}},{key:"getHeight",value:function(){return window.innerHeight}},{key:"getWidth",value:function(){return window.outerWidth}},{key:"getStartText",value:function(){if(void 0===this.state.data.chordpathids)return"";var t=["",""],e=this.state.data.idkeychordmap[this.state.data.chordpathids[0]];e&&(t=e.split(","));var n=["",""];return t[1]&&(n=t[1].split("-")),n[0].toUpperCase()+n[1]}},{key:"getDestinationText",value:function(){if(!this.state.data.idkeychordmap)return"";var t=["",""],e=this.state.data.idkeychordmap[this.PATH_DESTINATION];e&&(t=e.split(","));var n=["",""];return t[1]&&(n=t[1].split("-")),n[0].toUpperCase()+n[1]}},{key:"getColorFromKey",value:function(t){switch(t){case"a":return"green";case"a#":return"pink";case"b":return"yellow";case"c":return"orange";case"c#":return"black";case"d":return"red";case"d#":return"maroon";case"e":return"teal";case"f":return"brown";case"f#":return"purple";case"g":return"lime";case"g#":return"blue";default:return""}}},{key:"getStartColor",value:function(){if(void 0===this.state.data.chordpathids)return"";var t=["",""],e=this.state.data.idkeychordmap[this.state.data.chordpathids[0]];return void 0!==e&&(t=e.split(",")),this.getColorFromKey(t[0])}},{key:"getDestinationColor",value:function(){if(void 0===this.state.data.chordpathids)return"";var t=["",""],e=this.state.data.idkeychordmap[this.PATH_DESTINATION];return void 0!==e&&(t=e.split(",")),this.getColorFromKey(t[0])}},{key:"render",value:function(){return Object(a.jsxs)("div",{style:this.state.divStyle,className:this.state.startBtn.css,onClick:this.initAudio,children:[Object(a.jsxs)("div",{className:"bottomright",children:[Object(a.jsxs)("div",{className:"bottomborder",children:[Object(a.jsx)("div",{className:"bottomrightcircle",style:{background:this.getStartColor()}}),Object(a.jsxs)("div",{className:"bottomtext",children:["\xa0",this.getStartText()]})]}),Object(a.jsx)("div",{className:"emoji",children:"\u27a1\ufe0f"}),Object(a.jsxs)("div",{className:"bottomborder",children:[Object(a.jsx)("div",{className:"bottomrightcircle",style:{background:this.getDestinationColor()}}),Object(a.jsxs)("div",{className:"bottomtext",children:["\xa0",this.getDestinationText()]})]})]}),this.state.loading?Object(a.jsx)("div",{children:"Loading..."}):Object(a.jsx)(v.Graph,{id:"graph-id",data:this.state.data,config:this.state.myconfig}),Object(a.jsx)("div",{className:"bottomleft",children:Object(a.jsxs)("ol",{className:"custom-bullet medals",children:[Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"A"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"A#"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"B"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"C"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"C#"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"D"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"D#"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"E"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"F"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"F#"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"G"})," major"]}),Object(a.jsxs)("li",{children:[Object(a.jsx)("b",{children:"G#"})," major"]})]})})]})}}]),n}(r.a.Component);var C=function(){return Object(a.jsx)(c.a,{children:Object(a.jsx)("div",{className:"App",children:Object(a.jsx)(h.a,{path:"/",exact:!0,component:D})})})},N=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,147)).then((function(e){var n=e.getCLS,a=e.getFID,s=e.getFCP,r=e.getLCP,i=e.getTTFB;n(t),a(t),s(t),r(t),i(t)}))};n(141);o.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(C,{})}),document.getElementById("root")),N()},92:function(t,e,n){},93:function(t,e,n){}},[[143,1,2]]]);
//# sourceMappingURL=main.26eb5a8b.chunk.js.map